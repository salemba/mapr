Ansible sur windows:


Host : votre machine windows de développement, on va l'appeler machine vagrant parfois
Ansible: votre machine nstallé en utilisant WSL
VM: les machines du cluster créées avec Vagrant



1- Sur votre host, en utilisant la commande wsl --install sur PowerShell
Cette commande permet d'installer un "Ubuntu" dans votre windows
Une fois l'exécution de la commande terminée, redémarrer le host
Remarque: Parfois,le rédémarrage n'est pas nécessaire et une fenetre indiquant l'instllation de Ubuntu sera affiché

Quand l'installation sera terminé, il vous sera demandé de saisir un username et un mot de passe unix.
Utilisez un user et un mot de passe simple.Ex: ubuntu/ubuntu

2- mettre à jour les dépôt logiciels :
sudo apt update

3- Installer les logiciels indispensable pour le travil sur Ubuntu
sudo apt -y install software-properties-common

4- Ajouter le dépôt ansible 
sudo apt-add-repository ppa:ansible/ansible

5 - enore une fois : sudo apt update

6- lancer l'instllation de Ansible et de git:
sudo apt -y install ansible git

7- Vérfier l'installation
ansible --version

8- Ajouter l'utilisateur ansible sur cette sous-mchine linux et lui créer sa clé RSA
git clone https://github.com/salemba/mapr.git
cd mapr/vagrant
sudo chmod +x setup_ansible_user.sh
sudo ./setup_ansible_user.sh
sudo su ansible 
cd
ssh-keygen -t rsa -N "" -f ~/.ssh/id_rsa

9- Mettre à jour le fichier /etc/hosts en ajoutant les lignes suivantes

192.168.50.101 node01.cluster.master
192.168.50.102 node02.cluster.master
192.168.50.103 node03.cluster.master
192.168.50.199 edge.cluster.master




Vagrant et provisionnement de l'infra

8- Ouvrir une console CMD sur votre host et cloner le projet de base
git clone https://github.com/salemba/mapr.git

9- cd mapr/vagrant

10- vagrant up



Metre à jour le fichier /etc/hosts en ajoutant les lignes suivantes à la fin du fichier sur la machine vagrant

192.168.50.101 node01.cluster.master
192.168.50.102 node02.cluster.master
192.168.50.103 node03.cluster.master
192.168.50.199 edge.cluster.master



Sur la machine Ansible:

Installation & configuration de Mapr
1 - Revenir sur la console de votre sous-machine ubuntu (celle que vous avez créé avec wsl dans l'instruction 1-)
2- Assurez vous d'être l'utilisateur ansible, sinon, sudo su - ansible
3- cd
4- git clone https://github.com/salemba/mapr.git
5- cd mapr/ansible
6- Editer le fichier ansible.cfg pour faire pointer votre invnetory.ini dans la config par défaut, en ajoutant la ligne suivante:
	inventory = /home/ansible/mapr/ansible/inventory.ini
7- Editer le fichier  /home/ansible/mapr/ansible/mapr_configuration/vars/main.yml
	cluster_name: mapr.cluster.local
	email: "votre-email"
	repo_password: "votre-token-hpe"
	mapr_password: "mapr"


7- ansible-playbook -i inventory.ini ansible_setup_passwordless_ssh.yml
8- ansible all -m ping
9- ansible-playbook deploy_mapr.yml


